#!/bin/bash

# define colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[1;34m'
NC='\033[0m' # Keine Farbe (reset)

# Check if executed as root
#####################################################
if [ "$(id -u)" -ne 0 ]; then
    echo -e "${RED}>> This script must be run as root.${NC}"
    exit 1
fi

# Get Linux-Distro-Informations from /etc/os-release
#####################################################
if [ -f /etc/os-release ]; then
    . /etc/os-release

    if [[ "$ID" == "kali" ]]; then
        echo -e "${RED}>> This script does not support Kali Linux. Exiting...${NC}"
        exit 1
    else
        echo -e "${GREEN} > Detected Linux distribution: $NAME ($ID)${NC}"
    fi
else
    echo -e "${RED}>> Error: /etc/os-release not found. Unable to determine the Linux distribution.${NC}"
    exit 1
fi

#########################################################
# 		define FUNCTIONS			#
#########################################################

# detect system packagemanager
detectPackageManager() {
    if command -v apt >/dev/null 2>&1; then
        echo "apt"
    elif command -v pacman >/dev/null 2>&1; then
        echo "pacman"
    elif command -v dnf >/dev/null 2>&1; then
        echo "dnf"
    elif command -v yum >/dev/null 2>&1; then
        echo "yum"
    elif command -v zypper >/dev/null 2>&1; then
        echo "zypper"
    elif command -v apk >/dev/null 2>&1; then
        echo "apk"
    else
        echo -e "${RED}>> Unknown package manager${NC}"
    fi
}

# definition executionCall()
executionCall() {
    local packageManager="$1"

    if [[ "$packageManager" == "apt" ]]; then
        echo -e "${GREEN}"
        echo " > Detected Main Package Manager is apt"
	echo " > Install docker engine ..."
	apt update && apt install docker -y
	echo " > Start docker.service ..."
	systemctl start docker.service
	echo " > Install docker-compose ..."
	apt install docker-compose -y
	echo " > Setup default compose ..."
	docker-compose -f docker/default.docker-compose.yml up -d
	echo ">> Setup completed"
	echo -e "${NC}"

    elif [[ "$packageManager" == "pacman" ]]; then
	echo -e "${GREEN}"
        echo " > Detected Main Package Manager is pacman"
	echo " > Install docker engine ..."
        pacman -Suy
	yes | pacman -S docker
	echo " > Start docker.service ..."
	service docker start && systemctl start docker
        echo " > Install docker-compose ..."
        yes | pacman -S docker-compose
        echo " > Setup default compose ..."
        docker-compose -f docker/default.docker-compose.yml up -d
        echo ">> Setup completed"
	echo -e "${NC}"

    elif [[ "$packageManager" == "dnf" ]]; then
	echo -e "${GREEN}"
        echo " > Detected Main Package Manager is dnf"
        echo " > Install docker engine ..."
        dnf install docker-ce -y
        echo " > Start docker.service ..."
        systemctl start docker.service
        echo " > Install docker-compose ..."
        dnf install docker-compose -y
        echo " > Setup default compose ..."
        docker-compose -f docker/default.docker-compose.yml up -d
        echo ">> Setup completed"
	echo -e "${NC}"

    elif [[ "$packageManager" == "zypper" ]]; then
	echo -e "${GREEN}"
        echo " > Detected Main Package Manager is zypper"
        echo " > Install docker engine ..."
        zypper install docker -y
        echo " > Start docker.service ..."
        systemctl start docker.service
        echo " > Install docker-compose ..."
        zypper install docker-compose -y
        echo " > Setup default compose ..."
        docker-compose -f docker/default.docker-compose.yml up -d
        echo ">> Setup completed"
	echo -e "${NC}"

    elif [[ "$packageManager" == "apk" ]]; then
	echo -e "${GREEN}"
        echo " > Detected Main Package Manager is apk"
	echo " > Install docker engine ..."
        apk add docker -y
        echo " > Start docker.service ..."
        rc-update add docker default && /etc/init.d/docker start
        echo " > Install docker-compose ..."
        apk add docker-compose -y
        echo " > Setup default compose ..."
        docker-compose -f docker/default.docker-compose.yml up -d
        echo ">> Setup completed"
	echo -e "${NC}"

    else
        echo -e "${RED}>> Unsupportet package manager: $packageManager${NC}"
    fi
}

#################################################
#		Execute Script			#
#################################################
executionCall $(detectPackageManager)
